(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{920:function(module,exports,__webpack_require__){"use strict";eval("/* WEBPACK VAR INJECTION */(function($, global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends2 = __webpack_require__(61);\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _regenerator = __webpack_require__(17);\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = __webpack_require__(18);\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getPrototypeOf = __webpack_require__(36);\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(20);\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(22);\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(37);\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(38);\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _abstract = __webpack_require__(129);\n\nvar _abstract2 = _interopRequireDefault(_abstract);\n\nvar _AjaxService = __webpack_require__(71);\n\nvar _AjaxService2 = _interopRequireDefault(_AjaxService);\n\nvar _urlHelper = __webpack_require__(323);\n\nvar _urlHelper2 = _interopRequireDefault(_urlHelper);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n__webpack_require__(360);\n\nvar TrainingsOverviewListingController = function (_AbstractController) {\n  (0, _inherits3.default)(TrainingsOverviewListingController, _AbstractController);\n\n  function TrainingsOverviewListingController() {\n    (0, _classCallCheck3.default)(this, TrainingsOverviewListingController);\n    return (0, _possibleConstructorReturn3.default)(this, (TrainingsOverviewListingController.__proto__ || (0, _getPrototypeOf2.default)(TrainingsOverviewListingController)).apply(this, arguments));\n  }\n\n  (0, _createClass3.default)(TrainingsOverviewListingController, [{\n    key: 'main',\n    value: function main() {\n      this.$scope.trainings = {\n        courseList: {},\n        category: {}\n      };\n      var params = _urlHelper2.default.getQuery();\n      this.current_page = 1;\n\n      this.$trainingBlock = $('.trainings-overview-content');\n      this.$FilterForm = this.$trainingBlock.find('.filter-form form');\n      this.loadTraningList(params);\n      this.setDefaultValue();\n      this.initFilterForm();\n      this.handlePagination();\n    }\n\n    /**\n     * Change limit value for mobile\n     *\n     * @memberof FilterForm\n     */\n\n  }, {\n    key: 'setDefaultValue',\n    value: function setDefaultValue() {\n      var $search = this.$FilterForm.find('input[name=\"search\"]');\n      var $categoryType = this.$FilterForm.find('select[name=\"training_type_id\"]');\n      var $category = this.$FilterForm.find('select[name=\"training_cat_id\"]');\n      var params = _urlHelper2.default.getQuery();\n\n      if (params) {\n        if (params.search) {\n          $search.val(params.search);\n        }\n\n        if (params.training_type_id) {\n          $categoryType.selectpicker('val', params.training_type_id);\n        }\n\n        if (params.training_cat_id) {\n          $category.selectpicker('val', params.training_cat_id);\n        }\n\n        if (params.page) {\n          this.current_page = params.page;\n        }\n      }\n    }\n\n    /**\n     * init filter form\n     */\n\n  }, {\n    key: 'initFilterForm',\n    value: function initFilterForm() {\n      var _this3 = this;\n\n      var $FilterForm = this.$FilterForm;\n\n\n      $FilterForm.formValidator({\n        schema: function schema(yup) {\n          return {\n            search: yup.mixed()\n          };\n        },\n        onSuccess: function () {\n          var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(_ref2) {\n            var data = _ref2.data,\n                form = _ref2.form;\n            var query;\n            return _regenerator2.default.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    query = _urlHelper2.default.getQuery();\n\n                    _urlHelper2.default.removeQuery(query);\n                    _urlHelper2.default.appendQuery(data);\n                    _this3.loadTraningList(data);\n\n                  case 4:\n                  case 'end':\n                    return _context.stop();\n                }\n              }\n            }, _callee, _this3);\n          }));\n\n          return function onSuccess(_x) {\n            return _ref.apply(this, arguments);\n          };\n        }()\n      });\n    }\n  }, {\n    key: 'loadTraningList',\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(formData) {\n        var _this, $FilterForm, $courseBlock, posts_per_page, resp, dataTrainings, $pagination;\n\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this = this;\n                $FilterForm = this.$FilterForm;\n                $courseBlock = $('.course-listing-block');\n                posts_per_page = global.viewport.isMobile ? 3 : 10;\n\n\n                $FilterForm.loading(true);\n                $courseBlock.addClass('loading');\n\n                formData = (0, _extends3.default)({}, formData, {\n                  posts_per_page: posts_per_page\n                });\n\n                _context2.prev = 7;\n                _context2.next = 10;\n                return _AjaxService2.default.getInstance().sendFilterCourse(formData, {\n                  noMessage: true\n                });\n\n              case 10:\n                resp = _context2.sent;\n\n\n                if (resp) {\n                  this.$scope.trainings = {\n                    courseList: resp.trainings.data,\n                    category: resp.category\n                  };\n                  dataTrainings = resp.trainings;\n                  $pagination = $('#pagination-container');\n\n                  $pagination.html('');\n                  if (dataTrainings.total_pages > 1) {\n                    $pagination.pxpaginate({\n                      currentpage: dataTrainings.current_page,\n                      totalPageCount: dataTrainings.total_pages,\n                      maxBtnCount: 5,\n                      align: 'center',\n                      nextPrevBtnShow: true,\n                      firstLastBtnShow: true,\n                      callback: function callback(pagenumber, el) {\n                        if (Number(pagenumber) !== 0) {\n                          _urlHelper2.default.appendQuery({\n                            page: pagenumber\n                          });\n                          _this.loadTraningList(_urlHelper2.default.getQuery());\n                        }\n                      }\n                    });\n\n                    this.current_page = dataTrainings.current_page;\n\n                    // disale prev button\n                    if (Number(dataTrainings.current_page) === 1) {\n                      $pagination.find('.px-btn-prev').addClass('disabled');\n                    }\n                    // disale next button\n                    if (Number(dataTrainings.current_page) === Number(dataTrainings.total_pages)) {\n                      $pagination.find('.px-btn-next').addClass('disabled');\n                    }\n                  }\n                }\n                _context2.next = 17;\n                break;\n\n              case 14:\n                _context2.prev = 14;\n                _context2.t0 = _context2['catch'](7);\n\n                console.error(_context2.t0);\n\n              case 17:\n                $FilterForm.loading(false);\n                $courseBlock.removeClass('loading');\n\n              case 19:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[7, 14]]);\n      }));\n\n      function loadTraningList(_x2) {\n        return _ref3.apply(this, arguments);\n      }\n\n      return loadTraningList;\n    }()\n    /**\n    * handlePagination on click\n    * Hot fix when next & prev page number is 0\n    * @memberof TrainingsOverviewListingController\n    */\n\n  }, {\n    key: 'handlePagination',\n    value: function handlePagination() {\n      var _this4 = this;\n\n      $(document).on('click', '.px-btn-prev', function (e) {\n        if (Number(e.target.dataset.page) === 0) {\n          e.preventDefault();\n\n          _urlHelper2.default.appendQuery({\n            page: Number(_this4.current_page) - 1\n          });\n          _this4.loadTraningList(_urlHelper2.default.getQuery());\n        }\n      });\n\n      $(document).on('click', '.px-btn-next', function (e) {\n        if (Number(e.target.dataset.page) === 0) {\n          e.preventDefault();\n\n          _urlHelper2.default.appendQuery({\n            page: Number(_this4.current_page) + 1\n          });\n          _this4.loadTraningList(_urlHelper2.default.getQuery());\n        }\n      });\n    }\n  }]);\n  return TrainingsOverviewListingController;\n}(_abstract2.default);\n\nexports.default = TrainingsOverviewListingController;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(2), __webpack_require__(12)))\n\n//# sourceURL=webpack:///./views/pages/trainings-overview-listing/controller/TrainingsOverviewListingController.js?")}}]);